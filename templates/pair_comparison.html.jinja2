{% extends "base.html.jinja2" %}
{% block heading %}
    <h1 class="display-4">Debate Pairwise Comparison</h1>
    <p class="lead">Determine which side wins the debate game. </p>
    <hr class="my-4">
    <p>
        Thanks for participating!
    </p>
    <p>
        You'll review a recorded 20-minute debate between two debaters (humans or AI debaters) and evaluate the performance of each side. 
        You will be asked to complete a questionnaire, which includes your vote before and after the debate process on a predetermined topic. 
        There are three stages (openining, rebuttal, and closing) in the debate process. You need to compare the performance of each side in each stage.
        Finally, you will rate the performance of each side in the entire debate process and provide some optional feedback.
    </p>
    <p>
        <strong>Instructions:</strong>
        <ul>
            <li>For: for side win the game </li>
            <li>Against: against side win the game </li>
            <li>Tie: Two sides have similar performance  </li>
        </ul>
    </p>
{% endblock %}
{% block form_questions %}
    <input type="hidden" id="mode" name="mode" value="pair" >
    <input type="hidden" id="mode" name="version" value="{{ version }}" >

    {% for question in questions %}
        <div class="card form-group">
            <div class="card-header"><b>{{ question.title }}</b></div>
            <div class="card-body">
                <div class="audio-section">
                    {% for audio_path in question.audio_paths %}
                        <div class="row align-items-center mb-2">
                            <div class="col-1 text-left">
                                <strong>{{ audio_path[0] }}</strong>
                            </div>
                            <div class="col-3">
                                <audio controls src="{{ audio_path[1] }}" class="w-100">
                                    Your browser does not support the audio element.
                                </audio>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <div class="transcript-section mt-4">
                    {% for audio_path in question.audio_paths %}
                        <details class="transcript-details mb-3">
                            <summary class="transcript-summary p-2 bg-light rounded">
                                <i class="fas fa-file-alt mr-2"></i>
                                (Optional) {{ audio_path[0] }} - Transcript
                            </summary>
                            <div class="transcript-content p-3 bg-white border rounded mt-2">
                                {{ question.transcript[loop.index0] }}
                            </div>
                        </details>
                    {% endfor %}
                </div>

                <div class="rating-section">
                    {% for audio_path in question.audio_paths %}
                        <div class="form-group">
                            <label for="{{ question.name }}_{{ loop.index }}">
                                Rate the performance of {{ audio_path[0] }} side:
                            </label>
                            <div class="row align-items-center">
                                <div class="col-12 col-md-8 col-lg-6 offset-md-1 offset-lg-2">
                                    <input type="range" class="form-control-range w-80" id="{{ question.name }}_{{ loop.index }}" name="{{ question.name }}_{{ loop.index }}" min="1" max="5" value="3" step="1" required>
                                    <div class="d-flex justify-content-between position-relative" style="width: 110%; margin-left: -5%;">
                                        <span style="width: 33%; text-align: left;">Fair(1)</span>
                                        <span style="width: 34%; text-align: center;">Good(3)</span>
                                        <span style="width: 33%; text-align: right;">Excellent(5)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="{{ question.name }}_{{ loop.index }}_value"></div>
                        <script>
                            document.getElementById('{{ question.name }}_{{ loop.index }}').oninput = function() {
                                var value = this.value;
                                var output = document.getElementById('{{ question.name }}_{{ loop.index }}_value');
                                output.innerHTML = 'Current rating: ' + value;
                            }
                        </script>
                        <div class="form-group mt-3">
                            <label for="{{ question.name }}_{{ loop.index }}_comment"> (Optional) Additional comments for {{ audio_path[0] }} side:</label>
                            <textarea class="form-control" id="{{ question.name }}_{{ loop.index }}_comment" name="{{ question.name }}_{{ loop.index }}_comment" rows="1"></textarea>
                        </div>
                    {% endfor %}
                </div>

                <hr class="my-4">
                <div class="form-group">
                    <label for="{{ question.name }}" style="font-weight: bold; font-size: 1.1em;">
                        {{ question.description }}
                    </label>
                    <div class="row align-items-center">
                        <div class="col-12 col-md-8 col-lg-6 offset-md-1 offset-lg-2">
                            <input type="range" class="form-control-range w-100" id="{{ question.name }}" name="{{ question.name }}" min="-5" max="5" value="0" step="1" required>
                            <div class="d-flex justify-content-between position-relative" style="width: 110%; margin-left: -5%;">
                                <span style="width: 33%; text-align: left;">Against(-5)</span>
                                <span style="width: 34%; text-align: center;">Tie(0)</span>
                                <span style="width: 33%; text-align: right;">For(5)</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="{{ question.name }}_value"></div>
                <script>
                    document.getElementById('{{ question.name }}').oninput = function() {
                        var value = this.value;
                        var output = document.getElementById('{{ question.name }}_value');
                        if (value < 0) {
                            output.innerHTML = 'Current selection: ' + Math.abs(value) + ' towards Against';
                        } else if (value > 0) {
                            output.innerHTML = 'Current selection: ' + value + ' towards For';
                        } else {
                            output.innerHTML = 'Current selection: Tie';
                        }
                    }
                </script>
            </div>
        </div>
    {% endfor %}

    {% for question in addition_questions %}
        <div class="card form-group">
            <div class="card-header"><b>{{ question.title }}</b></div>
            <div class="card-body">
                {% if question.type == 'checkbox'  %}
                    <div class="form-group">
                        <label for="{{ question.name }}" style="font-weight: bold; font-size: 1.1em;">
                            {{ question.description }}
                        </label>
                        <div class="row align-items-center">
                            <div class="col-12 col-md-8 col-lg-6 offset-md-1 offset-lg-2">
                                <input type="range" class="form-control-range w-100" id="{{ question.name }}" name="{{ question.name }}" min="-5" max="5" value="0" step="1" required>
                                <div class="d-flex justify-content-between position-relative" style="width: 110%; margin-left: -5%;">
                                    <span style="width: 33%; text-align: left;">Against(-5)</span>
                                    <span style="width: 34%; text-align: center;">Tie(0)</span>
                                    <span style="width: 33%; text-align: right;">For(5)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="{{ question.name }}_value"></div>
                    <script>
                        document.getElementById('{{ question.name }}').oninput = function() {
                            var value = this.value;
                            var output = document.getElementById('{{ question.name }}_value');
                            if (value < 0) {
                                output.innerHTML = 'Current selection: ' + Math.abs(value) + ' towards Against';
                            } else if (value > 0) {
                                output.innerHTML = 'Current selection: ' + value + ' towards For';
                            } else {
                                output.innerHTML = 'Current selection: Tie';
                            }
                        }
                    </script>
                {% else %}
                    <div class="form-group">
                        <label for="{{ question.name }}"></label>
                        <textarea class="form-control" type="text" inputmode="text" row="2" name="{{ question.name }}"></textarea>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% endblock %}



